# 类银河战士恶魔城游戏开发规划文档

## 项目概述
本游戏将基于现有平台跳跃DEMO扩展为完整的类银河战士恶魔城(Metroidvania)游戏，包含角色成长、技能系统、多样敌人、BOSS战、关卡设计和丰富道具系统。

## 开发阶段规划

### 第一阶段：基础架构扩展 (2-4周)

#### 目标
- 实现核心游戏系统框架
- 建立角色成长和技能系统
- 创建基础敌人AI
- 设计首个小型关卡

#### 任务分解
1. **角色成长系统**
   ```javascript
   class Player {
     constructor() {
       this.level = 1;
       this.exp = 0;
       this.attributes = {
         strength: 5, // 影响物理攻击
         agility: 5,  // 影响移动速度和闪避
         vitality: 5, // 影响生命值
         intelligence: 5 // 影响魔法攻击
       };
       this.skillPoints = 0;
       this.unlockedSkills = [];
     }
     
     addExp(amount) {
       this.exp += amount;
       const requiredExp = this.level * 100;
       if(this.exp >= requiredExp) {
         this.levelUp();
       }
     }
     
     levelUp() {
       this.level++;
       this.exp -= requiredExp;
       this.skillPoints += 3;
       // 每级增加基础属性
       this.attributes.strength += 1;
       this.attributes.agility += 1;
       this.attributes.vitality += 1;
       this.attributes.intelligence += 1;
     }
     
     unlockSkill(skillId) {
       if(this.skillPoints > 0) {
         this.unlockedSkills.push(skillId);
         this.skillPoints--;
       }
     }
   }
   ```

2. **技能系统实现**
   ```javascript
   const Skills = {
     DOUBLE_JUMP: {
       id: 'double_jump',
       name: "二段跳",
       description: "允许在空中再次跳跃",
       cost: 1,
       unlockLevel: 3
     },
     DASH: {
       id: 'dash',
       name: "冲刺",
       description: "快速向前冲刺一小段距离",
       cost: 2,
       unlockLevel: 5
     },
     FIREBALL: {
       id: 'fireball',
       name: "火球术",
       description: "发射一个火球攻击敌人",
       cost: 3,
       unlockLevel: 7,
       manaCost: 10
     }
   };
   ```

3. **敌人AI系统**
   ```javascript
   class EnemyAI {
     constructor(enemy) {
       this.enemy = enemy;
       this.states = {
         IDLE: 0,
         PATROL: 1,
         CHASE: 2,
         ATTACK: 3
       };
       this.currentState = this.states.IDLE;
     }
     
     update(player) {
       const distance = Phaser.Math.Distance.Between(
         this.enemy.x, this.enemy.y,
         player.x, player.y
       );
       
       if(distance < 100) {
         this.currentState = this.states.ATTACK;
       } else if(distance < 300) {
         this.currentState = this.states.CHASE;
       } else {
         this.currentState = this.states.PATROL;
       }
       
       switch(this.currentState) {
         case this.states.PATROL:
           this.patrolBehavior();
           break;
         case this.states.CHASE:
           this.chaseBehavior(player);
           break;
         case this.states.ATTACK:
           this.attackBehavior(player);
           break;
       }
     }
     
     patrolBehavior() {
       // 巡逻逻辑
     }
     
     chaseBehavior(player) {
       // 追逐玩家逻辑
     }
     
     attackBehavior(player) {
       // 攻击逻辑
     }
   }
   ```

4. **关卡设计**
   - 使用Tiled地图编辑器创建首个关卡
   - 设计垂直结构：地下区域、平台层、隐藏房间
   - 实现能力门系统（需要特定技能才能开启）
   - 添加存档点和传送点

### 第二阶段：核心系统实现 (4-8周)

#### 目标
- 完善装备和道具系统
- 实现BOSS战斗机制
- 创建技能树UI
- 添加商店和合成系统

#### 任务分解
1. **装备系统**
   ```javascript
   class Equipment {
     constructor(type, name, stats) {
       this.type = type; // weapon/armor/accessory
       this.name = name;
       this.stats = stats; // { attack: 10, defense: 5 }
       this.specialEffects = [];
     }
   }
   
   const EquipmentDatabase = {
     IRON_SWORD: new Equipment('weapon', '铁剑', { attack: 10 }),
     FLAME_ARMOR: new Equipment('armor', '火焰铠甲', { defense: 15, fireResist: 30 })
   };
   ```

2. **BOSS战斗设计**
   ```javascript
   class Boss {
     constructor(scene, x, y, key) {
       this.scene = scene;
       this.sprite = scene.physics.add.sprite(x, y, key);
       this.health = 1000;
       this.phases = [
         { healthThreshold: 0.7, pattern: "phase1" },
         { healthThreshold: 0.3, pattern: "phase2" },
         { healthThreshold: 0, pattern: "phase3" }
       ];
     }
     
     update() {
       const healthRatio = this.health / this.maxHealth;
       const currentPhase = this.phases.find(p => healthRatio <= p.healthThreshold);
       this.executePattern(currentPhase.pattern);
     }
     
     executePattern(pattern) {
       switch(pattern) {
         case "phase1":
           // 第一阶段攻击模式
           break;
         case "phase2":
           // 第二阶段攻击模式
           break;
         case "phase3":
           // 最终阶段攻击模式
           break;
       }
     }
   }
   ```

3. **技能树UI**
   ```javascript
   function createSkillTreeUI() {
     const skillTreeContainer = this.add.container(100, 100);
     
     // 背景
     const background = this.add.rectangle(0, 0, 600, 400, 0x1a1a2e);
     skillTreeContainer.add(background);
     
     // 标题
     const title = this.add.text(0, -180, '技能树', { fontSize: '32px', fill: '#fff' });
     title.setOrigin(0.5);
     skillTreeContainer.add(title);
     
     // 技能节点
     Object.values(Skills).forEach((skill, index) => {
       const skillNode = this.add.circle(-200 + index * 100, 0, 30, skill.unlocked ? 0x00ff00 : 0x444444);
       skillNode.setInteractive();
       skillNode.on('pointerdown', () => this.unlockSkill(skill.id));
       skillTreeContainer.add(skillNode);
       
       const skillName = this.add.text(skillNode.x, skillNode.y + 40, skill.name, { fontSize: '16px', fill: '#fff' });
       skillName.setOrigin(0.5);
       skillTreeContainer.add(skillName);
     });
     
     return skillTreeContainer;
   }
   ```

4. **商店和合成系统**
   - 实现商店UI界面
   - 创建货币系统（金币、灵魂碎片等）
   - 设计合成配方系统
   - 添加NPC交互功能

### 第三阶段：内容填充 (8-16周)

#### 目标
- 扩展游戏世界（4个不同主题区域）
- 添加多样化敌人和精英怪
- 设计3个独特BOSS战
- 实现任务系统和剧情

#### 任务分解
1. **区域设计**
   | 区域 | 主题 | 特色机制 | 主要敌人 |
   |------|------|----------|---------|
   | **幽暗森林** | 森林/沼泽 | 毒雾区域、藤蔓攀爬 | 树精、毒蜘蛛 |
   | **熔岩洞窟** | 火山/洞穴 | 熔岩伤害、高温区域 | 熔岩怪、火蝙蝠 |
   | **机械要塞** | 蒸汽朋克 | 移动平台、齿轮机关 | 机械守卫、炮台 |
   | **远古神殿** | 神秘遗迹 | 重力反转、能量屏障 | 守护者、幽灵 |

2. **敌人多样化**
   - **普通敌人**：10+种不同类型
   - **精英敌人**：特殊外观、增强属性、独特技能
   - **迷你BOSS**：守卫关键区域
   - **环境危害**：尖刺、熔岩、毒雾

3. **BOSS设计**
   ```javascript
   class ForestGuardianBoss extends Boss {
     constructor(scene, x, y) {
       super(scene, x, y, 'forest_boss');
       this.attackPatterns = {
         phase1: this.phase1Pattern,
         phase2: this.phase2Pattern,
         phase3: this.phase3Pattern
       };
     }
     
     phase1Pattern() {
       // 召唤藤蔓攻击
     }
     
     phase2Pattern() {
       // 毒雾扩散+种子射击
     }
     
     phase3Pattern() {
       // 狂暴模式+全屏攻击
     }
   }
   ```

4. **任务系统**
   ```javascript
   class Quest {
     constructor(id, title, description, objectives, rewards) {
       this.id = id;
       this.title = title;
       this.description = description;
       this.objectives = objectives; // { type: 'collect', target: 'item_id', amount: 5 }
       this.rewards = rewards; // { exp: 500, items: ['item_id'], gold: 200 }
       this.completed = false;
     }
     
     checkCompletion() {
       // 检查目标是否完成
     }
   }
   
   const Quests = {
     RESCUE_ALCHEMIST: new Quest(
       'rescue_alchemist',
       '解救炼金术师',
       '炼金术师被困在森林深处，请救出他',
       [{ type: 'reach', location: 'forest_camp' }],
       { exp: 1000, items: ['healing_potion_x3'], gold: 500 }
     )
   };
   ```

### 第四阶段：优化完善 (4周)

#### 目标
- 平衡游戏难度
- 优化性能
- 添加视听效果
- 完善存档系统

#### 任务分解
1. **游戏平衡**
   - 调整敌人强度曲线
   - 优化技能消耗和效果
   - 平衡装备属性
   - 添加难度选项（简单/普通/困难）

2. **性能优化**
   ```javascript
   // 对象池管理
   class ObjectPool {
     constructor(scene, type, size) {
       this.scene = scene;
       this.type = type;
       this.pool = [];
       
       for(let i = 0; i < size; i++) {
         let obj;
         if(type === 'bullet') {
           obj = new Bullet(scene, 0, 0);
         } else if(type === 'enemy') {
           obj = new Enemy(scene, 0, 0);
         }
         obj.setActive(false).setVisible(false);
         this.pool.push(obj);
       }
     }
     
     get(x, y) {
       const obj = this.pool.find(o => !o.active);
       if(obj) {
         obj.setActive(true).setVisible(true);
         obj.x = x;
         obj.y = y;
         return obj;
       }
       return null; // 或创建新对象
     }
     
     release(obj) {
       obj.setActive(false).setVisible(false);
     }
   }
   ```

3. **视听效果增强**
   - 添加环境音效和背景音乐
   - 实现攻击命中特效
   - 添加屏幕震动效果
   - 设计UI动画和过渡效果

4. **存档系统**
   ```javascript
   function saveGame() {
     const saveData = {
       player: {
         position: { x: this.player.x, y: this.player.y },
         health: this.player.health,
         maxHealth: this.player.maxHealth,
         level: this.player.level,
         exp: this.player.exp,
         skills: this.player.unlockedSkills,
         equipment: this.player.equipment
       },
       world: {
         currentMap: this.currentMap,
         visitedAreas: this.visitedAreas,
         completedQuests: this.completedQuests
       },
       inventory: this.inventory.items
     };
     
     localStorage.setItem('gameSave', JSON.stringify(saveData));
     return saveData;
   }
   ```

## 开发路线图

| 阶段 | 时间 | 里程碑 | 交付物 |
|------|------|--------|--------|
| **基础架构扩展** | 第1-4周 | 可玩的游戏原型 | 角色系统、基础敌人、首个关卡 |
| **核心系统实现** | 第5-12周 | 完整游戏循环 | 装备系统、BOSS战、技能树 |
| **内容填充** | 第13-28周 | 完整游戏体验 | 4个区域、30+敌人、3个BOSS |
| **优化完善** | 第29-32周 | 发布候选版 | 平衡调整、性能优化、完整存档 |

## 资源需求

### 美术资源
1. **角色动画**：行走、奔跑、攻击、受伤、死亡等
2. **敌人设计**：普通敌人10种、精英敌人5种、BOSS 4种
3. **环境图块**：森林、洞穴、火山、机械、神殿主题
4. **UI元素**：技能图标、装备栏、血条、地图界面

### 音效资源
1. **环境音效**：森林、洞穴、火山等不同场景
2. **角色音效**：跳跃、攻击、受伤、升级
3. **敌人音效**：移动、攻击、死亡
4. **背景音乐**：区域主题音乐、BOSS战音乐

### 开发工具
1. **Tiled**：地图编辑 (https://www.mapeditor.org/)
2. **Aseprite**：像素艺术创作 (https://www.aseprite.org/)
3. **Bosca Ceoil**：音乐创作 (https://boscaceoil.net/)
4. **Audacity**：音效处理 (https://www.audacityteam.org/)

## 风险管理

1. **范围蔓延**：
   - 优先实现核心功能
   - 使用最小可行产品(MVP)方法
   - 定期评估进度

2. **美术资源瓶颈**：
   - 优先使用占位素材
   - 利用免费资源库(OpenGameArt)
   - 考虑外包部分美术工作

3. **技术挑战**：
   - 提前研究复杂功能实现
   - 保持代码模块化
   - 定期重构代码

4. **时间管理**：
   - 制定详细周计划
   - 每日进度跟踪
   - 预留缓冲时间

通过遵循此开发规划，您将能够系统性地将现有DEMO扩展为完整的类银河战士恶魔城游戏，同时控制开发风险并确保项目成功。